<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>ぺちぱな。Q 〜たまには決められた通りに繰り返すのもいい〜</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <style>
            body {
                padding-top: 50px;
                padding-bottom: 20px;
            }
        </style>

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="js/vendor/prettify/prettify.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/jquery-1.10.1.min.js"></script>
        <script src="js/main.js"></script>
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/jquery.easing.1.3.js"></script>
        <script src="js/vendor/prettify/prettify.js"></script>
    </head>

    <body onload="prettyPrint();">
        <div id="my_top"></div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-3 sidebar">
                    <ul class="nav nav-sidebar">
                        <li>
                            <a href="javascript:smoothScroll('1_0');" style="color : black;">
                                1章. はじめに
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('1_1');">
                                配布資料の確認
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('1_2');">
                                コンピュータゲームの歴史
                            </a>
                        </li>


                        <li>
                            <a href="javascript:smoothScroll('1_3');">
                                enchant.js&nbsp;とは
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('1_4');">
                                サンプルを動かしてみよう
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('2_0');" style="color : black;">
                                2章. enchant.jsを使ったゲームの仕組み
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('2_1');">
                                ゲームプログラムはパラパラ漫画のように
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('2_2');">
                                enchant.jsのセットアップ
                            </a>
                        </li>


                        <li>
                            <a href="javascript:smoothScroll('2_3');">
                                前準備はクラスの定義から
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('2_4');">
                                メインループの基本処理
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('3_0');" style="color : black;">
                                3章. クマを動かせるようにしてみよう
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('3_1');">
                                スプライトを描画する
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('3_2');">
                                キー入力を受け取る&nbsp;〜もしなになにだったら〜
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('3_3');">
                                クマを動かせるようにしてみよう:実践編
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('4_0');" style="color : black;">
                                4章. 障害物を設置して、衝突判定をつけてみよう
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('4_1');">
                                当たって砕ける、衝突判定いろいろ
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('4_2');">
                                衝突判定を作るには
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('4_3');">
                                クマが障害物にぶつかった時のイベントを作ってみよう:実践編
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('5_0');" style="color : black;">
                                5章. よりゲームっぽくしてみよう
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('5_1');">
                                完成図をイメージしよう
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('5_2');">
                                動くのはクマだけじゃない！？障害物にも動きをつけてみよう！
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('5_3');">
                                一定のタイミングで障害物を配置してみよう
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('5_4');">
                                一定のタイミングで障害物を配置してみよう:実践編
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('5_5');">
                                スコア用のラベルを表示するには？
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('5_6');">
                                スコア判定を追加してみよう:実践編
                            </a>
                        </li>

                        <li>
                            <a href="javascript:smoothScroll('6_0');" style="color : black;">
                                さいごに
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="col-sm-9 col-sm-offset-3" style="position:absolute;top:0px;">
                    <div class="page-header">
                        <h1>ぺちぱな。Q <small>〜たまには決められた通りに繰り返すのもいい〜</small></h1>
                    </div>

                    <div class="section_block">
                        <div class="page-header">
                            <h2 id="1_0">1章. はじめに</h2>
                        </div>

                        <!-- exam_content -->
                        <div class="exam_content">
                            <a href="javascript:smoothScroll('my_top');">
                                ↑トップへ戻る
                            </a>

                            <!-- 序文 -->
                            <div class="exam_description">
                                <p>
                                    おはようございます！<b>「ぺちぱな。Q 〜たまには決められた通りに繰り返すのもいい〜」</b>へようこそ！<br />
                                    今回のハンズオンはenchant.jsと言うJavaScriptライブラリを使って<b>「ゲームがどのような仕組みで動いているのか」</b>をテーマに行います！<br />
                                    用意はよろしいですか？それでは、張り切ってまいりましょう！どうぞ！
                                </p>
                            </div>

                            <!-- 配布資料の確認 -->
                            <div class="exam_inline">
                                <h3 id="1_1">配布資料の確認</h3>

                                <div class="exam_description">
                                    <p>
                                        まず、はじめに本日のハンズオンの配布資料を確認します。<br />
                                        とは言っても、全部を説明するわけではなくて主要となるファイルにフォーカスをあてて紹介したいと思います！
                                    </p>
                                </div>

                                <ul>
                                    <li>
                                        <dl>
                                            <dt>~/Guide/index.html</dt>
                                            <dd style="margin-top : 5px;">
                                                <p>
                                                    みなさまが、今開いているガイドブックです。<br />ここのファイルに手を加えていくことは今回はありません〜。
                                                </p>
                                            </dd>
                                        </dl>
                                    </li>

                                    <li>
                                        <dl>
                                            <dt>~/Chapter/Chapter3<br />~/Chapter/Chapter4<br />~/Chapter/Chapter5</dt>
                                            <dd style="margin-top : 5px;">
                                                <p>
                                                    本日のハンズオンは章構成で行われます。<br />
                                                    各章で取り上げられるテーマに合わせて機能紹介用のプログラムが全てこの中に入っています。
                                                </p>
                                            </dd>
                                        </dl>
                                    </li>

                                    <li>
                                        <dl>
                                            <dt>~/Sample</dt>
                                            <dd style="margin-top : 5px;">
                                                <p>
                                                    具体的にどのようなゲームが作れるのか、enchant.jsが提供しているデモゲームが保存されています。
                                                </p>
                                            </dd>
                                        </dl>
                                    </li>

                                    <li>
                                        <dl>
                                            <dt>~/src</dt>
                                            <dd style="margin-top : 5px;">
                                                <p>
                                                    本日のハンズオンで皆さんに編集していただくプログラムのデータがこの中に保存されています。<br />
                                                </p>
                                            </dd>
                                        </dl>
                                    </li>
                                </ul>

                                <div class="exam_description">
                                    <p>
                                        ダウンロードは<a href="https://www.dropbox.com/s/m89nsfc5eu7kbef/Q.zip" target="_blank">こちら</a>からどうぞ。
                                    </p>
                                </div>
                            </div>

                            <!-- コンピュータゲームの歴史 -->
                            <div class="exam_inline">
                                <h3 id="1_2">コンピュータゲームの歴史</h3>
                                <div class="well exam_margin">
                                    <h5>1840年代</h5>
                                    <i>
                                        イギリスの数学者チャールズ・バベッジは、機械にゲームを行わせることに興味を持ち、解析エンジン（コンピュータ）を考えた。ただし、チェスの場合は組合せが膨大になることから成功しなかった。
                                    </i>

                                    <h5>1983年</h5>
                                    <i>
                                        7月15日 - 任天堂「ファミリーコンピュータ」（ファミコン）
                                    </i>

                                    <h5>1994年</h5>
                                    <i>
                                        11月22日 - セガ「セガサターン」。同時発売としてビクターVサターン・日立Hiサターンがある。
                                    </i>

                                    <div class="quote">
                                        Wikipedia - <a href="http://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%AE%E6%AD%B4%E5%8F%B2" target="_blank">コンピュータゲームの歴史</a> より
                                    </div>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        コンピュータゲームの歴史を紐解いてみると、はじまりはなんと1840年頃からとなっており、今日までで170年ほどの歴史があります。<br />
                                        僕の家にはじめてやってきたゲーム機はファミコンでした。はじまりから何年も先の話です。スーパーマリオブラザーズばっかり遊んでいました。<br /><br />
                                        それが、時が経ってセガサターンやプレイステーションが登場し、2Dのものから奥行きのある3Dのゲームが家庭用ゲーム機にも登場してきて、グラフィック・演出も格段にパワーアップしました。<b>「実写のようだな」「とんでもない事が起きてしまった」</b>と当時思ったりしたものでした。<br /><br />
                                        そんな事がゲーム機の世代が変わる度に起こるとは予想も出来ず、大人になった今でも次世代機が発表される度に・新しいゲームが発表される度にわくわくするとは思ってもいませんでした。<br /><br />

                                        今回の「ぺちぱな。」ではそんなゲームがいったいぜんたいどのような仕組みで動いてるのか？をテーマに行います！<br />
                                        ゲーム開発向けフレームワークでもあります<b>enchant.js</b>を使って、グラフィックの描画・動き・衝突判定を持ったゲームを作りながら、ゲームの仕組みを知っていけたらと思います。
                                    </p>
                                </div>
                            </div>

                            <!-- enchant.js&nbsp;とは -->
                            <div class="exam_inline">
                                <h3 id="1_3">enchant.js&nbsp;とは</h3>

                                <div class="exam_description">
                                    <p>
                                        enchant.jsは<b>株式会社ユビキタスエンターテインメント</b>が開発したゲーム開発向けのHTML5/JavaScriptベースのフレームワークです。
                                    </p>
                                    <img src="./img/enchantjs.png" class="img-thumbnail img-responsive" alt="enchant.js">
                                </div>

                                <div class="well">
                                    <ul>
                                        <li>
                                            <i>
                                                ゲームやアプリを開発できる HTML5 + JavaScript フレームワークです。
                                            </i>
                                        </li>

                                        <li>
                                            <i>
                                                2011年に公開され、すでに 1,000 本以上のゲーム/アプリが公開されています。
                                            </i>
                                        </li>

                                        <li>
                                            <i>
                                                オープンソース (MITライセンス) で、無料で利用できます。
                                            </i>
                                        </li>

                                        <li>
                                            <i>
                                                ドキュメント・書籍・チュートリアルサイトが充実しています。
                                            </i>
                                        </li>

                                        <li>
                                            <i>
                                                たくさんのプラグインで機能を拡張できます。
                                            </i>
                                        </li>

                                        <li>
                                            <i>
                                                UEI/ARC を中心としたメンバによって開発・メンテナンスされています。
                                            </i>
                                        </li>

                                        <li>
                                            <i>
                                                プログラミング教育のためにも利用されています。
                                            </i>
                                        </li>
                                    </ul>
                                    <div class="quote">
                                        enchant.js - A simple JavaScript framework for creating games and apps.  - <a href="http://enchantjs.com/ja/" target="_blank">enchant.js is...</a> より
                                    </div>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        enchant.jsでは「物体の描画」「キー入力」「衝突判定」と言ったゲーム開発に必要な機能が扱いやすい形で提供されています。<br />
                                        今回は基本機能の部分でenchant.jsに乗っかりつつ、ゲームがどのように作られているのか見ていきたいと思います。<br /><br />

                                        なお、enchant.jsで作られたゲームは、投稿型ゲームサイト<a href="http://9leap.net" target="_blank">9leap</a>に投稿し、公開する事が出来ます。<br />
                                        教育用途でも使われている事から開発にも幾分取っ掛かりやすく(少ないコード量で、大きな動きがつけれたり)<br />
                                        作ったものを公開し・遊んでもらえる環境まで整っているためプログラミングの入門としても適したコンテンツとなっています:-)
                                    </p>
                                </div>
                            </div>

                            <!-- サンプルを動かしてみる -->
                            <div class="exam_inline">
                                <h3 id="1_4">サンプルを動かしてみよう</h3>
                                <div class="exam_description">
                                    <p>
                                        enchant.jsを使ってどんなゲームを作る事が出来るのか、一例としてサンプルのゲームを動かしてみます！<br />
                                        サンプルのゲームは以下のリンクからアクセスする事が出来ます。少しだけ遊んでみましょう！<br /><br />

                                        &gt;&gt; <a href="../Sample/shooting/index.html" target="_blank">shooting</a>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        画面上でマウスを操作すると、ゲームが開始します。<br />
                                        マウスの動きにあわせて上下に移動しながら、向かってくる敵を倒していくシンプルなシューティングゲームになっています。<br />
                                        他にも様々なジャンルのサンプルが用意されており、enchant.jsではゲームを作るための機能が一通り揃ったフレームワークとなっています。<br /><br />
                                        他にもどんなゲームがあるか気になる方は、<a href="http://9leap.net" target="_blank">9leap</a>にユーザーが開発したゲームが数多く投稿されています。<br />
                                        興味のある方はこちらも合わせてご覧ください :-)
                                    </p>
                                </div>
                            </div>

                        </div>
                        <!-- exam_content -->
                    </div>

                    <div class="section_block">
                        <div class="page-header">
                            <h2 id="2_0">2章. enchant.jsを使ったゲームの仕組み</h2>
                        </div>

                        <!-- exam_content -->
                        <div class="exam_content">
                            <a href="javascript:smoothScroll('my_top');">
                                ↑トップへ戻る
                            </a>

                            <div class="exam_description">
                                <p>
                                    ここでは、実際にキャラクターを操作するプログラムを書いて、ゲームがどのようにして動いているのかを見ていきたいと思います。
                                </p>
                            </div>

                            <!-- ゲームプログラムはパラパラ漫画のように -->
                            <div class="exam_inline">
                                <h3 id="2_1">ゲームプログラムはパラパラ漫画のように</h3>

                                <div class="exam_description">
                                    <p>
                                        ゲームプログラムの仕組みをざっくりと別の何かに例えると、<b>ページがどこまでも続くパラパラ漫画</b>に例えることが出来ます。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/palapala.jpg" class="img-thumbnail img-responsive" alt="enchant.js">
                                            <h5>Wikipedia - パラパラ漫画より</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        ゲームのプログラムはパラパラ漫画のように絶えず画面が更新される仕組みとなっており、この中で事前に組み込んだプログラムが決められた通りに動いていきます。このような仕組みの事をプログラム的に<b>メインループ</b>と呼んでいます。<br />
                                        メインループ上にユーザーのキー操作・時間の経過などを定義する事によって、ページがめくられる度に画面の情報が更新されていくイメージになります。そうとは言っても、これだけではピンと来ないところもあるかもしれません。<br />
                                        そこで、実際にキャラクターを操作するプログラムを作りながら、より詳しく紹介したいと思います。
                                    </p>
                                </div>
                            </div>

                            <!-- enchant.jsのセットアップ -->
                            <div class="exam_inline">
                                <h3 id="2_2">enchant.jsのセットアップ</h3>

                                <div class="exam_description">
                                    <p>
                                        enchant.jsを使ったゲーム開発をはじめるにあたってenchant.jsのセットアップを行います。<br />
                                        本項では既に用意されたものを使って、セットアップにあたってどういった記述が必要なのか要点をかいつまんで紹介します。<br /><br />

                                        みなさまに編集していただくソースファイルは、下記ディレクトリに保管されています。<br />
                                        これらをもとに簡単な紹介を行いますので、こちらのプログラムをお好みのテキストエディタで開いてからご確認ください。
                                    </p>
                                </div>

                                <ul>
                                    <li>
                                        <dl>
                                            <dt><a href="../src/edit/index.html" target="_blank">~/src/edit/index.html</a></dt>
                                            <dd style="margin-top : 5px;">
                                                <p>
                                                    開発したゲームが実行されるページのファイルとなります。<br />
                                                    こちらはテキストエディタと合わせてブラウザでもファイル名のリンクから確認してみましょう！
                                                </p>
                                            </dd>
                                        </dl>
                                    </li>

                                    <li>
                                        <dl>
                                            <dt>~/src/edit/main.js/</dt>
                                            <dd style="margin-top : 5px;">
                                                <p>
                                                    各章の最後で、こちらのプログラムを拡張しながらゲームを作っていきます。<br />
                                                    ハンズオンで実際に編集するファイルは今回こちらのみとなっております。
                                                </p>
                                            </dd>
                                        </dl>
                                    </li>
                                </ul>

                                <div class="exam_description">
                                    <p>
                                        みなさま、お好みのテキストエディタでソースファイルを開いていただけたでしょうか？<br />
                                        ~/src/edit/index.htmlのプログラムをブラウザ上で確認すると、以下のような画面が表示されます。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/2-1.png" class="img-thumbnail img-responsive" alt="enchant.js">
                                            <h5>So Spacy!(とても、宇宙的...)</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        宇宙空間を背景に野生のくまが駆け抜けると言うなかなかに<b>スペイシー</b>な画面が表示されるかと思います、いかがでしょうか。<br />
                                        今回のハンズオンではこちらのプログラムを拡張していきながら、ゲームがどのようにして動いているのか紹介します。<br />
                                        まずはじめにenchant.jsで作ったゲームを動かすにあたって、どのような準備が必要なのかを紹介します。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>../src/edit/index.html</h4>
                                    <pre class="prettyprint lang-html linenums">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta http-equiv="x-ua-compatible" content="IE=Edge"&gt;
    &lt;meta name="viewport" content="width=device-width, user-scalable=no"&gt;
    &lt;meta name="apple-mobile-web-app-capable" content="yes"&gt;
    &lt;script type="text/javascript" src="./libs/enchant.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="main.js"&gt;&lt;/script&gt;
    &lt;style type="text/css"&gt;
        body {
            margin: 0;
            padding: 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        enchant.jsではページを表示するindex.htmlに対して、処理を書く事は基本的にありません。<br />
                                        ソースコード上の8行目と9行目で呼び出されている外部JavaScriptファイルの呼び出しが肝の部分になっています。<br /><br />
                                        こちらでenchant.jsの機能を呼び出す為の準備を行っていて、処理自体はmain.jsに書いていく事になります。<br />
                                        main.jsで書かれた処理をもとにして、ページ上でゲームが実行される仕組みとなります。<br /><br />
                                    </p>
                                </div>


                                <div class="exam_description">
                                    <h4>~/src/edit/main.js</h4>
                                    <pre class="prettyprint lang-js linenums">
window.onload = function(){
    enchant();                  // enchant.jsの利用宣言　必ず最初に宣言する

    var game_score    = 0;      // スコア管理用の変数
    var window_width  = 320;    // ゲーム領域の幅
    var window_height = 568;    // ゲーム領域の高さ

    // CoreObjectの定義
    var game = new Core(window_width,window_height);
    game.fps = 30.0;
    game.preload('./libs/images/chara1.png', 
                 './libs/images/background.png',
                 './libs/images/pipe.png');

    game.onload = function(){
        // 背景画像の定義
        var bg   = new Sprite(window_width, window_height);
        bg.image = this.assets['./libs/images/background.png'];
        bg.x     = 0;
        bg.y     = 0;
        bg.frame = 0;
        // 背景のスクロール
        bg.on('enterframe', function(){
            this.x -= 10;
            // 画面外に到達したら座標を調整
            if(this.x <= -window_width){
                this.x = window_width;
            }
        });

        // 背景画像の定義
        var bg2   = new Sprite(window_width, window_height);
        bg2.image = this.assets['./libs/images/background.png'];
        bg2.x     = window_width;
        bg2.y     = 0;
        bg2.frame = 0;
        // 背景のスクロール
        bg2.on('enterframe', function(){
            this.x -= 10;
            // 画面外に到達したら座標を調整
            if(this.x <= -window_width){
                this.x = window_width;
            }
        });
        // 定義した画像を、事前に描画する
        game.rootScene.addChild(bg);
        game.rootScene.addChild(bg2);

        // クマ (プレイヤーの定義)
        var size   = 32;
        var bear   = new Sprite(size,size);
        bear.image = this.assets['./libs/images/chara1.png'];   // 描画する画像を指定する
        bear.x     = (window_width/2)-(size/2);                 // 画像の描画位置の指定(x軸)
        bear.y     = (window_height/2)-(size/2);                // 画像の描画位置の指定(軸)
        bear.frame = 0;                                         // 描画領域の範囲を指定する
        game.rootScene.addChild(bear);                          // クマを画面上に描画する

        // メインループ
        game.on('enterframe', function(){
            //　主要なプログラムはこの中に書いていきます
        });
    }

    game.start();
};
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        おっとっと、いきなりのプログラムになんだか目眩が・・・。enchant.jsはコードの頭で<b>enchant();</b>を呼び出す事ではじめて使えるようになります。ちょっと面食らう部分もあるかもしれませんが、今回の進行上で重要な部分だけをピックアップしてここでは紹介したいと思います。
                                    </p>
                                </div>
                            </div>

                            <!-- 前準備はクラスの定義から -->
                            <div class="exam_inline">
                                <h3 id="2_3">前準備はクラスの定義から</h3>
                                <div class="exam_description">
                                    <h4>~/src/edit/main.js</h4>
                                    <pre class="prettyprint lang-js linenums">
window.onload = function(){
    enchant();                  // enchant.jsの利用宣言　必ず最初に宣言する

    var game_score    = 0;      // スコア管理用の変数
    var window_width  = 320;    // ゲーム領域の幅
    var window_height = 568;    // ゲーム領域の高さ

    // CoreObjectの定義
    var game = new Core(window_width,window_height);
    game.fps = 30.0;
    game.preload('./libs/images/chara1.png', 
                 './libs/images/background.png',
                 './libs/images/pipe.png');

... 途中省略 ...
</pre>
                                </div>


                                <div class="exam_description">
                                    <p>
                                        JavaScriptでは<b>window.onload = function(){}</b>の<b>{}</b>で囲われた領域のプログラムが画面読み込み時に実行されます。<br />
                                        ここでは<b>9行目</b>でenchant.jsが提供している、Coreクラスのインスタンスを生成しています。<br /><br />
                                        Coreクラスでは引数に幅と高さをそれぞれセットする事でウィンドウ領域のサイズを決める事が出来ます。<br />
                                        <b>window_width</b>と<b>window_height</b>の数値に合わせてサイズが変化するようになっているので、良かったら話を聞きながらでも弄ったりしてみてください:-)<br /><br />
                                        クラスとは用途を絞った機能群を包括した器のようなもので、Coreクラスにはゲームの進行全般を管理する為の機能がまとめられています。<br />
                                        クラスというのがいったいなんなのかピンと来ない人は<b>親子丼</b>をイメージしてみましょう。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/oyako.jpg" class="img-thumbnail img-responsive" alt="美味しそう">
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        親子丼を親子丼たらしめるには、まっさらな器だけでは難しいものがあります。<br />
                                        親子丼たらしめるべく器に<b>ご飯</b>をよそい<b>だしの効いた半熟のとき卵</b>・<b>鶏肉</b>・<b>三つ葉</b>を乗せなければなりません。<br />
                                        クラスもまっさらなままでは、そのクラスが何を為しているのかがわかりません。<br /><br />
                                        そのためCoreクラスでは<b>ゲームの進行を管理する</b>事をテーマにして、進行管理に必要な機能・細かい設定項目を取りまとめています。<br />
                                        開発者は提供されているクラスをインスタンス化する事によって、手っ取り早くそれらの機能を利用する事が出来るようになります。<br /><br />
                                        今回のぺちぱな。ではCoreクラス以外にもいくつかのクラスが登場します。<br />
                                        クラスごとにどういった用途があって、どのようにして使われるのかはその都度合わせて紹介したいと思います。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>~/src/edit/main.js</h4>
                                    <pre class="prettyprint lang-js linenums:8">
// CoreObjectの定義
var game = new Core(window_width,window_height);
game.fps = 30.0;
game.preload('./libs/images/chara1.png', 
             './libs/images/background.png',
             './libs/images/pipe.png');

... 途中省略 ...
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        Coreクラスのインスタンスを生成したら、さらに設定を行っていきます。ソースコードの10行目では<b>FPS</b>の設定を行っています。<br />
                                        FPSは一秒あたりに処理されるフレーム数のことを表しています。game.fpsには<b>30.0</b>を代入しているので、この例では一秒あたりに30回分のフレーム経過・ループが行われる事を意味しています。<br /><br />
                                        パラパラ漫画に例えると、一秒間に30ページずつめくれていくイメージで考えていただけると大丈夫です:-)<br /><br />
                                        11行目では<b>preload</b>と言う命令を呼び出して、事前に読み込む画像をセットしています。<br />
                                        今回は事前に利用する画像を全てセットしているので、ここに対して手を加えていく事はありません。<br />
                                        もし、ご自身でいろいろ画像を追加したいと思った時にはこちらも忘れずに追加するようにしておきましょう:-)
                                    </p>
                                </div>
                            </div>
                            <!-- exam_inline -->

                            <!-- メインループの基本処理 -->
                            <div class="exam_inline">
                                <h3 id="2_4">メインループの基本処理</h3>
                                <div class="exam_description">
                                    <h4>~/src/edit/main.js</h4>
                                    <pre class="prettyprint lang-js linenums:13">
... 途中省略 ...

game.onload = function(){
    /*
        背景の描画処理
    */

    // クマ (プレイヤーの定義)
    var size   = 32;
    var bear   = new Sprite(size,size);
    bear.image = this.assets['./libs/images/chara1.png'];   // 描画する画像を指定する
    bear.x     = (window_width/2)-(size/2);                 // 画像の描画位置の指定(x軸)
    bear.y     = (window_height/2)-(size/2);                // 画像の描画位置の指定(軸)
    bear.frame = 0;                                         // 描画領域の範囲を指定する
    game.rootScene.addChild(bear);                          // クマを画面上に描画する

    // メインループ
    game.on('enterframe', function(){
        //　主要なプログラムはこの中に書いていきます
    });
}

game.start();
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        ソースコードの<b>15行目</b>から無名関数内にゲーム中の処理を定義しています。<br />
                                        ここからの内容がメイン部分の処理になってきます。<br />
                                        定義した無名関数を<b>game.onload</b>に代入する事で代入された関数の処理に沿ってゲームが動くようになります。<br /><br />

                                        上記のコード表では<b>30行目</b>となっていますが、そこからはメインループの定義を書いています。<br />また、メインループより前にはゲーム上で利用される画像の描画を行っています。<br /><br />
                                        波括弧の範囲内に書いたプログラムは、ページを読み込んだ後もくり返しくり返し実行されます。<br />この中でユーザーのキー入力などはを受け取りながら、事前に定義した決められた処理を決められた通りにくり返して行くわけです:-)<br /><br />

                                        とは言っても、ここまでの内容だけではいまいちピンと来ない部分もあるかもしれません。<br />
                                        そこで、次の項目では画像の描画についても取り上げつつ、実際にクマを操作するプログラムを作ってより詳しく内容を見ていきます。
                                    </p>
                                </div>
                            </div>
                            <!-- exam_inline -->
                        </div>
                        <!-- exam_content -->
                    </div>


                    <div class="section_block">
                        <div class="page-header">
                            <h2 id="3_0">3章. クマを表示して動かせるようにしてみよう</h2>
                        </div>

                        <!-- exam_content -->
                        <div class="exam_content">
                            <a href="javascript:smoothScroll('my_top');">
                                ↑トップへ戻る
                            </a>

                            <div class="exam_description">
                                <p>
                                    2章ではenchant.jsのセットアップを皮切りに、大枠の動きと仕組みについて紹介を行いました。<br />
                                    3章では、2章でちょっと出てきた<b>メインループ</b>がどういうものなのかをプログラムを書きながら紹介したいと思います。<br />
                                    実際にキー入力操作を受け取るプログラムを書いて、クマを動かせるようにしてみましょう:-)
                                </p>
                            </div>

                            <!-- クマの画像を描画する -->
                            <div class="exam_inline">
                                <h3 id="3_1">スプライトを描画する</h3>

                                <div class="exam_description">
                                    <p>
                                        画像を描画するには、<b>Sprite</b/>クラスを用いて行います。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>~/src/edit/main.js</h4>
                                    <pre class="prettyprint lang-js linenums:48">
... 途中省略 ...
    // クマ (プレイヤーの定義)
    var size   = 32;
    var bear   = new Sprite(size,size);
    bear.image = this.assets['./libs/images/chara1.png'];   // 描画する画像を指定する
    bear.x     = (window_width/2)-(size/2);                 // 画像の描画位置の指定(x軸)
    bear.y     = (window_height/2)-(size/2);                // 画像の描画位置の指定(軸)
    bear.frame = 0;                                         // 描画領域の範囲を指定する
    game.rootScene.addChild(bear);                          // クマを画面上に描画する

... 途中省略 ...
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        Spriteクラスをインスタンス化する時に、引数に描画する画像の幅と高さをそれぞれセットする事ができます。<br />
                                        こうする事で<b>スプライト</b>を生成する事が出来ます。<b>スプライト</b>はイメージ的には額のようなもので、実際の画像から描画領域を決定してはめこまれた物が画面上に表示されるようになっています。<br />ここでは描画を行う前に画像の指定と、それをどこに描画するのかx軸とy軸それぞれに指定しています。<br />
                                        実際に<b>53行目</b>で指定している画像chara1.pngは以下のような画像になっています。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/3-1.png" class="img-thumbnail img-responsive" alt="3-1.png">
                                            <h5>いろいろなクマが...</h5>
                                        </div>

                                        <div class="align_center">
                                            <img src="./img/3-1_mark.png" class="img-thumbnail img-responsive" alt="3-1_mark.png">
                                            <h5>bear.frameの値に合わせて変わるんです。</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        このように複数の画像を1つの画像にタイル状に取りまとめたものを<b>スプライトシート</b>と言います。
                                        個別に画像を準備する場合と比べた場合、役割に合わせて画像をまとめる事で管理が行いやすく、画像の容量を抑える事が出来るメリットがあります。<br /><br />
                                        enchant.jsではこのようなスプライトシートを手軽に使う為の機能が提供されています。<b>56行目</b>の<b>bear.frame</b>がそうです。<br /><br />
                                        明示的に指定していない場合、ないしは0を代入している場合はスプライトシートの左上を基準にインスタンス化した際に引数で渡した画像の幅と高さをもとにしてスプライトを生成します。試しにサンプルのプログラムで<b>bear.frame</b>に代入する値を0から1へとじゅんぐり上げていくと赤枠の描画領域から、右に1つずつずれて表示されます。もし良かったら聞きながらでも構いませんので、いろいろと数値をいじってどうなるか試してみてください:-)
                                    </p>
                                </div>
                            </div>

                            <!-- キー入力を受け取る&nbsp;〜もしなになにだったら〜 -->
                            <div class="exam_inline">
                                <h3 id="3_2">キー入力を受け取る&nbsp;〜もしなになにだったら〜</h3>

                                <div class="exam_description">
                                    <p>
                                        スプライト描画についての仕組みがわかったところで、いよいよ描画されたクマをユーザーの操作で動かせるようにしていきます。<br />
                                        実際に、キー入力によってクマが上下左右に入力されたキーに合わせて動くようにします。<br /><br />
                                        キー入力を受け取って画面に結果を反映させる為には<b>「もし上方向にキーが押されていたら」</b><b>「もし下方向にキーが押されていたら」</b>のように<b>「もしなになにだったら」</b>と言う処理を追加してあげなければなりません。JavaScriptでは<b>if文</b>を使うことによって実現する事が出来ます。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>JavaScriptでもしもなになにだったら〜</h4>
                                    <pre class="prettyprint lang-js linenums">
// 単体
if (/* 条件式 */) {
    // 条件式に一致した時に実行される処理
}

// 複数分岐
if (/* 条件1 */) {
    // 条件1に一致した時に実行される処理
}else if (/* 条件2 */){
    // 条件2に一致した時に実行される処理
}else{
    // 条件1にも条件2にも一致しない場合実行される処理
}

// 例 ログには「正」の字が出力される
var value = 1;
if(value==1){
    console.log('正');
}else{
    console.log('不正');
}
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        JavaScriptにおけるif文の書き方は上記のような形になっています。条件式をもとにして正しい内容であれば、括弧の中へと処理が進んでいくようになります。また、<b>else if</b>を使うことによって、複数の条件を候補としたより柔軟な処理が行えるようになります。<br /><br />
                                        この内容をもとにして、キー入力を受け取れるようにしたサンプルが下記になります。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>~/Chapter/Chapter3/inputs/main.js</h4>
                                    <pre class="prettyprint lang-js linenums">
window.onload = function(){
    enchant();  // enchant.jsの利用宣言　必ず最初に宣言する

    var window_width  = 320;    // ゲーム領域の幅
    var window_height = 568;    // ゲーム領域の高さ

    // CoreObjectの定義
    var game = new Core(window_width,window_height);
    game.fps = 30.0;

    game.onload = function(){
        // メインループ（この中に処理を書いていきます)
        game.on('enterframe', function(){
            if(game.input.up){
                console.log('方向キーの上キーが押されました');
            }else if (game.input.down){
                console.log('方向キーの下キーが押されました');
            }else if (game.input.left){
                console.log('方向キーの左キーが押されました');
            }else if (game.input.right){
                console.log('方向キーの右キーが押されました');
            }
        });
    }

    game.start();
};
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <a href="../Chapter/Chapter3/inputs/index.html" target="_blank">ブラウザから確認すると</a>、画面上ではこれと言って何も表示されていませんが、上下左右の方向キーのいずれかを入力すると、対応するログがコンソール上に出力される事を確認する事ができます。<br />
                                        <b>enchant.js</b>はCoreクラスの<b>input</b>でゲームに対する入力操作を管理しており、<b>if文</b>を使ってこのような形で条件式としてメインループ内で定義することによってユーザーのキー入力に対する処理を実装する事が出来ます。
                                    </p>
                                </div>
                            </div>

                            <!-- クマを動かせるようにしてみよう:実践編 -->
                            <div class="exam_inline">
                                <h3 id="3_3">クマを動かせるようにしてみよう:実践編</h3>

                                <div class="exam_description">
                                    <p>
                                        それではここまでの内容を踏まえて<b>~/src/edit/main.js</b>を拡張します。クマを操作して動かす為のプログラムを書いてみましょう！<br />
                                        なお、はじめに処理の流れを確認したいと思います。おおまかな処理の流れは以下の通りです。
                                    </p>
                                </div>

                                <div class="well">
                                    <h5>おだいもく</h5>
                                    <ul class="procedure">
                                        <li>処理自体はメインループの中に定義していく</li>
                                        <li>現在中央に表示されている、クマをキー入力に合わせて動かせるようにする</li>
                                        <li>if文を使って「もし上方向に押されていたら」と言う形で、上下左右の方向キーに対する処理を追加する</li>
                                        <li>3番で定義したif文にそれぞれクマの移動処理を実装します</li>
                                    </ul>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        なお、描画されたクマのスプライトの座標は<b>bear.x, bear.y</b>のように定義したスプライトの<b>x, y</b>それぞれに数値を代入する事で表示される座標を更新する事が出来るようになっています。<br />
                                        この点に対してあらかじめ確認した上で、クマを自由に動けるようにプログラムを拡張してみましょう！
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- exam_content -->
                    </div>

                    <div class="section_block">
                        <div class="page-header">
                            <h2 id="4_0">4章. 障害物を設置して、衝突判定をつけてみよう</h2>
                        </div>

                        <!-- exam_content -->
                        <div class="exam_content">
                            <a href="javascript:smoothScroll('my_top');">
                                ↑トップへ戻る
                            </a>

                            <div class="exam_description">
                                <p>
                                    3章では、メインループの仕組みをよりイメージしやすくするべくキー入力操作のプログラムを実装しました！<br />
                                    キャラクターを画面上に描画して、動かせるようになったら今度は衝突判定について紹介していきます。<br />
                                    キャラクターを動かして、衝突判定をつけれるようになったら<b>それはもうゲーム！</b>それでは、張り切ってまいりましょう！
                                </p>
                            </div>

                            <!-- 当たって砕ける、衝突判定いろいろ -->
                            <div class="exam_inline">
                                <h3 id="4_1">当たって砕ける、衝突判定いろいろ</h3>

                                <div class="exam_description">
                                    <p>
                                        <b>衝突判定は</b>ある物体と、それとは異なる別の物体が衝突したのかそうでないかを判定するプログラムの事を言います。別の言い方として当たり判定なんて言い方もあります。衝突判定にもいろいろな方法がありますが、その中でも基本となるものは矩形による衝突判定処理です。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/collision.png" class="img-thumbnail img-responsive" alt="衝突判定">
                                            <h5>矩形の衝突判定</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        このように描画された物体の範囲を矩形として扱うことで、それぞれの座標を確認して物体同士の重なりを表現し判定する事が出来ます。<br />
                                        ただし、描画される物体には矩形でないものが多いので、画像によっては物体同士が衝突していなくても衝突されたものとして扱われる場合もあります。出来る限り画像と矩形の大きさを同じようにする事で自然な形になります。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        矩形の判定が基本的な判定処理となりますが、単純な矩形の判定を自分で作ろうと思っても結構大変です。<br />
                                        そこで、今回はenchant.jsのSpriteクラスに内包されている<b>intersect</b>メソッドを使った衝突判定の付け方を紹介します。
                                    </p>
                                </div>
                            </div>


                            <!-- 衝突判定を作るには -->
                            <div class="exam_inline">
                                <h3 id="4_2">衝突判定を作るには</h3>

                                <div class="exam_description">
                                    <p>
                                        それでは衝突判定の実装について、サンプルをもとに紹介したいと思います！
                                        <a href="../Chapter/Chapter4/collision/index.html" target="_blank">ブラウザから確認</a>してみると以下のような画面が表示されます。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/bear_pipe.png" class="img-thumbnail img-responsive" alt="クマと土管と...">
                                            <h5>クマと土管と...</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <b>クマ</b>と<b>土管</b>という珍妙な組み合わせの画面が表示されましたでしょうか！
                                        こちらのプログラムでは実際にクマを操作して動かす事が出来るようになっており、土管にぶつかるとブラウザ上でアラートが表示されるようになっています。そこにはなんと衝撃のメッセージが・・・。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>~/Chapter/Chapter4/collision/main.js</h4>
                                    <pre class="prettyprint lang-js linenums:19">
... 途中省略 ...

// 障害物の定義
var pipe   = new Sprite(64, 568);
pipe.image = game.assets['./libs/images/pipe.png'];
pipe.x     = window_width-128;
pipe.y     = 100;
pipe.frame = 0;
game.rootScene.addChild(bear);  // クマを画面上に描画する
game.rootScene.addChild(pipe);  // 障害物を画面上に描画する

// メインループ（この中に処理を書いていきます)
game.on('enterframe', function(){
    // クマと土管が衝突したらif文の中へ
    if(bear.intersect(pipe)){
        game.stop();
        window.alert("GAME OVER...");
    }

... 途中省略 ...
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        事前に障害物となる土管を描画する事で、メインループの先頭でクマと土管の衝突判定処理を組み込んでいます。<br />
                                        衝突判定の実装は<b>33行目</b>から行っています。このように描画した物体(スプライト)のintersectメソッドを呼び出して、引数に衝突判定を行う物体をセットする事で、物体同士の衝突判定を行う事が出来ます。物体同士が衝突している場合にif文の中の処理が実行されます。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        そして、なんという事でしょう・・・。ここではクマと土管が衝突すると<b>GAME OVER...</b>と書かれたアラートが出力されます！<br />
                                        ここでは簡単なゲームオーバー処理を行っています。Coreクラスの<b>stop</b>メソッドがそうです。<br />
                                        <b>stop</b>メソッドを呼び出す事によって、<b>start</b>メソッドが呼び出されているCoreクラス内のメインループを全て停止する事が出来ます。<br />
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        また、ここで描画されている土管は今後も障害物用として利用していきます。<br />
                                        土管の元画像はクマの元画像の用に複数の画像を取りまとめた<b>スプライトシート</b>として管理しています。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/pipe.png" class="img-thumbnail img-responsive" alt="pipe.png">
                                            <h5>土管が障害物になるんです</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        こちらもクマの画像と同様に<b>frame</b>の値を0から1に変更する事によって、画面上に描画する内容を変更することが出来ます。<br />
                                        これを上手く使うと<a href="../Chapter/Chapter4/collision/index.html" target="_blank">サンプル</a>では下から上に突き出しているような表現になっていますが、座標と合わせて調整してあげる事で上から下に突き出しているような表現も行えるようになります。<br />
                                        もし良かったら聞きながらでも構いませんので、いろいろとframeや座標(x,y軸)を弄って試してみてください:-)
                                    </p>
                                </div>
                            </div>

                            <!-- クマが障害物にぶつかった時のイベントを作ってみよう -->
                            <div class="exam_inline">
                                <h3 id="4_3">クマが障害物にぶつかった時のイベントを作ってみよう:実践編</h3>

                                <div class="exam_description">
                                    <p>
                                        それではここまでの内容を踏まえて<b>~/src/edit/main.js</b>を拡張していきましょう！<br />
                                        自分が操作するクマが<b>宇宙空間に突如現れた土管</b>に衝突した時のプログラムを書いていきます。<br />
                                        またしても、はじめに処理の流れを確認したいと思います。おおまかな処理の流れは以下の通りです。
                                    </p>
                                </div>

                                <div class="well">
                                    <h5>おだいもく</h5>
                                    <ul class="procedure">
                                        <li>処理自体はメインループの中に定義していく</li>
                                        <li>画面上の適当な位置へ土管を描画する</li>
                                        <li>if文と組み合わせて「クマと土管が衝突した場合」を条件にした、衝突判定を作る</li>
                                        <li>メインループを停止し、アラートを出力する</li>
                                    </ul>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        4章では衝突判定についての紹介と、enchant.jsでの実装の仕方について紹介しました。<br />
                                        次章が最後の内容となっていて、これまでの内容を踏まえてよりゲームっぽくしていきたいと思います。
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- exam_content -->
                    </div>
                    <!-- section -->

                    <div class="section_block">
                        <div class="page-header">
                            <h2 id="5_0">5章. よりゲームっぽくしてみよう</h2>
                        </div>

                        <!-- exam_content -->
                        <div class="exam_content">
                            <a href="javascript:smoothScroll('my_top');">
                                ↑トップへ戻る
                            </a>

                            <div class="exam_description">
                                <p>
                                    4章では衝突判定についての紹介と、enchant.jsの場合における実装の仕方について紹介してきました。5章ではこれまでの内容を踏まえて等間隔での障害物の配置や、スコアの加算処理を組み合わせてよりゲームっぽくするために必要な機能の作り方を紹介したいと思います。
                                </p>
                            </div>

                            <!-- 完成図をイメージしよう -->
                            <div class="exam_inline">
                                <h3 id="5_1">完成図をイメージしよう</h3>

                                <div class="exam_description">
                                    <p>
                                        さあさあ、それでは早速作り進めていきましょう！・・・と言いたいところですが、気持ちをグッとこらえてどんな形にしていくのかまずは完成図をイメージしていきましょう。<a href="../Chapter/Chapter5/complete/index.html" target="_blank">こちら</a>を開いてみてください。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/game.png" class="img-thumbnail img-responsive" alt="pipe.png">
                                            <h5>これが・・・ゲームだ！</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <b>宇宙空間</b>に<b>突如</b>として<b>飛来</b>した<b>土管の群れ</b>・・・。それを<b>懸命</b>に<b>潜り抜け</b>ていく<b>クマ</b>・・・。<b>明日</b>は、<b>どっちだ！？</b><br />
                                        と、ちょっとばかり取り乱してしまいましたが、遊んでみるとなんだかゲームっぽい。と言うか、ゲームになってる。なんだかそんな感じがしませんか？どうでしょう・・・。<br />
                                        遊んでみるととても難しそうに感じるかもしれませんが、これまでの内容をベースにしていく事でここまでのものが作れるようになります。<br />
                                        ゲームを構成する要素として、どのようなものが備わっているのかを落ち着いて確認してみましょう。
                                    </p>
                                </div>

                                <div class="well">
                                    <h5>完成予定のゲームを構成する要素</h5>
                                    <ul class="procedure">
                                        <li>クマの表示・キー操作による上下移動</li>
                                        <li>障害物となる土管の表示・右から左への移動</li>
                                        <li>障害物は一定間隔でランダムな隙間を作って表示される</li>
                                        <li>土管を潜り抜けると、上部のスコアが加算されていく</li>
                                        <li>クマと土管における衝突判定、ゲーム終了のアラートが表示される</li>
                                    </ul>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        こうして明文化して列挙してみると、なんだかちょっとだけ出来そうな気がしてきました。この中で今回のハンズオンでまだ取り扱っていない内容は<b>2番</b>の土管移動と<b>3番</b>と<b>4番</b>の内容となっています。どちらもゲームを作る上で大切な機能となっています！<br />
                                        これらの機能はenchant.jsでは比較的簡単に実装する事が出来ます。次の内容より早速ですがどのような仕組みで作られているのかをご紹介したいと思います。遊びながらでもオッケーです:-)
                                    </p>
                                </div>
                            </div>

                            <!-- 動くのはクマだけじゃない！？障害物にも動きをつけてみよう！ -->
                            <div class="exam_inline">
                                <h3 id="5_2">動くのはクマだけじゃない！？障害物にも動きをつけてみよう！</h3>

                                <div class="exam_description">
                                    <p>
                                        まず、はじめに障害物に動きをつける方法についてご紹介したいと思います。<br />
                                        4章で作ったプログラムの内容には障害物に対する衝突判定が実装されているものの、それが動いたりすることはありませんでした。<br />
                                        これが障害物が動くようになる事によって、<b>動く障害物をかわしていく</b>といったゲームが作れるようになります！<br />
                                        こちらもサンプルのプログラムを見ながら紹介したいと思います。<a href="../Chapter/Chapter5/move/index.html" target="_blank">こちら</a>を開いてみてください:-)
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/move_pipe.png" class="img-thumbnail img-responsive" alt="move_pipe.png">
                                            <h5>右から左に土管が流れていますか？</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        キー操作の時に行った方法を使って、ループをくり返す度に土管のx軸座標を更新します。そうすると、上手い具合に画面上で障害物が動いてるさまを表現する事ができます。特段変わった仕組みは今回の内容では行っておりませんが、1つだけ確認したい内容があります。サンプルに実装されている、下記のコードです。
                                    </p>
                                </div>

                               <div class="exam_description">
                                    <h4>~/Chapter/Chapter5/move/main.js</h4>
                                    <pre class="prettyprint lang-js linenums:10">
... 途中省略 ...

game.onload = function(){
    // 障害物の定義
    var pipe   = new Sprite(64, window_height);
    pipe.image = game.assets['./libs/images/pipe.png'];
    pipe.x     = window_width;
    pipe.y     = 100;
    pipe.frame = 0;
    game.rootScene.addChild(pipe);  // 障害物を画面上に描画する

    // 画面全体とは別にスプライトに対しても毎フレームごとの動きを定義できる
    pipe.on('enterframe', function(){
        this.x -= 2;
    });

... 途中省略 ...
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        これまでは、ゲームの進行全般を管理しているCoreクラスで提供されている<b>on</b>メソッドを使って、毎フレームごとに繰り返し実行される処理を定義してきました。実は、Coreクラスからだけではなく同じようにSpriteクラスからでもonメソッドを呼び出す事ができます。<br />
                                        <b>21行目から24行目</b>がその処理となっていて。こうする事で、Coreクラスで定義しているメインループとは別に描画しているスプライトに対しても毎フレームごとに実行される処理を定義する事が出来るようになります！
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        なお、JavaScriptで受け取ったイベントの処理内容として定義されている無名関数内の<b>this</b>はイベントもとのオブジェクトの事を指します。<br />
                                        ちょっとでも覚えておくと、見通しも良くより安全なコードが書けるかもしれません:-)<br />
                                        本サンプルでは描画した土管のスプライトを指しており、毎フレームにx軸を少しずつずらしていく。という処理になっています。
                                    </p>
                                </div>
                            </div>


                            <!-- 一定のタイミングで障害物を配置してみよう -->
                            <div class="exam_inline">
                                <h3 id="5_3">一定のタイミングで障害物を配置してみよう</h3>

                                <div class="exam_description">
                                    <p>
                                        障害物の土管を動かせるようになったら、今度は障害物を一定のタイミング毎に配置をしていく方法をサンプルをもとに紹介していきます！<br />
                                        まずはじめに<a href="../Chapter/Chapter5/schedule/index.html" target="_blank">こちら</a>のプログラムを開いてみてください。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <div class="align_center">
                                            <img src="./img/schedule.png" class="img-thumbnail img-responsive" alt="schedule.png">
                                            <h5>一定の間隔で土管がいろいろな高さでどんどん流れてきます。</h5>
                                        </div>
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        動かしてみると、一定の間隔で土管が右から左に不規則な高さで流れていくのを確認する事が出来ます。<br />
                                        このような仕組みはゲームでは結構多くて、作り方もいろいろあるかと思うのですが今回は一例として経過フレーム数をもとにして、障害物となる土管を描画していく方法について紹介したいと思います。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        enchant.jsでは<b>Core</b>クラスの<b>frame</b>というプロパティから、ゲームがスタートしてからの経過フレーム数を受け取る事が出来ます。<br />
                                        今回のサンプルでは経過フレーム数をもとに、60フレームおきに土管を描画して右から左に流すように処理を定義しています。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>~/Chapter/Chapter5/schedule/main.js</h4>
                                    <pre class="prettyprint lang-js linenums:39">
... 途中省略 ...

// 60フレームおきに、土管を表示する
if(game.frame%60==0){
    // 障害物の定義
    var pipe_width  = 64;
    var pipe_height = 568;

    var pipe        = new Sprite(pipe_width, pipe_height);
    pipe.image      = game.assets['./libs/images/pipe.png'];
    pipe.x          = window_width;
    pipe.y          = (pipe_height/2)-Math.floor(Math.random() * 150);
    pipe.frame      = 0;
    game.rootScene.addChild(pipe);  // 障害物を画面上に描画する

    pipe.on('enterframe', function(){
        this.x -= 2;

        // クマと土管が衝突したらif文の中へ
        if(bear.intersect(this)){
            game.stop();
            window.alert("GAME OVER...");
        }
    });
}

... 途中省略 ...
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        <b>経過フレーム数が割り切れる場合に〜〜をする</b>場合3章でも取り上げた、if文を組み合わせる事で実現する事が出来ます。<br />条件式には<b>経過フレーム数/60の余りが0</b>だったら真とする。という条件が入っています。<br />
                                        こうする事によって経過フレーム数が60の倍数の時に60で割り切れるので、60フレームおきに何らかの処理を行う。と言った事が出来るようになります。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        今回の内容では他に真新しいところはなく、60フレームおきに障害物を描画するというものになっていますが、障害物の高さをまばらにする為に乱数を生成して調整するようにしています。<br />
                                        50行目で行っており<b>Math.floor(Math.random()*150)</b>では150までを範囲にランダムに数を返すようになっています。<br />
                                        こういった乱数を用いて障害物の高さをまばらにする事で、遊んでいて退屈しないような仕組みを取り入れれるようになります。
                                    </p>
                                </div>
                            </div>

                            <!-- 一定のタイミングで障害物を配置してみよう:実践編 -->
                            <div class="exam_inline">
                                <h3 id="5_4">一定のタイミングで障害物を配置してみよう:実践編</h3>


                                <div class="exam_description">
                                    <p>
                                        それではここまでの内容を踏まえて<b>~/src/edit/main.js</b>を拡張していきましょう！<b>宇宙空間</b>に<b>突如</b>として<b>飛来</b>した<b>土管の群れ</b>・・・。<br />
                                        こちらをクマを操作して潜り抜けていくプログラムを作っていきます。<br />
                                        今回の内容は少し複雑なところもあって項目も多いので、落ち着いてまずは処理の流れを確認したいと思います。
                                    </p>
                                </div>

                                <div class="well">
                                    <h5>おだいもく</h5>
                                    <ul class="procedure">
                                        <li>処理はメインループの中で定義していく</li>
                                        <li>自身のキャラクターとなるクマの移動範囲を上方向と下方向のみに修正する</li>
                                        <li>60フレームおきに処理を動かす為の条件式を追加する</li>
                                        <li>60フレームおきに上下それぞれに潜り抜ける隙間が有る土管を描画し、右から左へとフレーム毎に移動させる</li>
                                        <li>if文と組み合わせて「クマと土管が衝突した場合」を条件にした衝突判定を作る</li>
                                        <li>衝突した場合メインループを停止し、アラートを出力する</li>
                                    </ul>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        ここまで行く事が出来れば、あとはスコア加算の処理を行うだけです:-)<br />
                                        ゲーム上で文字を描画する場合、enchant.jsでは<b>Label</b>クラスを利用する事が出来ます。<br />
                                        次の項目ではそんな<b>Label</b>クラスについて紹介させていただき、スコアの加算処理を作ってみたいと思います。
                                    </p>
                                </div>
                            </div>

                            <!-- スコア用のラベルを表示するには？ -->
                            <div class="exam_inline">
                                <h3 id="5_5">スコア用のラベルを表示するには？</h3>

                                <div class="exam_description">
                                    <p>
                                        画面上に文字を表示する場合、<b>enchant.js</b>では<b>Label</b>クラスを使って実現する事が出来ます。<br />
                                        <a href="../Chapter/Chapter5/label/index.html" target="_blank">ブラウザから確認</a>すると、画面上部中央に「1192」と書かれている画面が表示されているかと思います。
                                    </p>
                                </div>

                                <div class="exam_description">
                                    <h4>~/Chapter/Chapter5/label/main.js</h4>
                                    <pre class="prettyprint lang-js linenums">
window.onload = function(){
    enchant();

    // CoreObjectの定義
    var window_width  = 320;    // ゲーム領域の幅
    var window_height = 568;    // ゲーム領域の高さ

    var game = new Core(window_width,window_height);
    game.fps = 30.0;

    game.onload = function(){
        // スコア表示用のラベル
        var score_label   = new Label(String(1192));        // new Label(1192);とかだとエラーになる
        var label_width   = score_label._boundWidth;        // 描画したラベルの幅を取得する
        var label_height  = score_label._boundHeight;       // 描画したラベルの高さを取得する

        score_label.x     = 10;
        score_label.y     = 10;
        score_label.color = '#000';
        game.rootScene.addChild(score_label);
    }

    game.start();
};
</pre>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        スプライトの動きなど一切行われていない、ラベルを表示するだけのシンプルなプログラムになっています。<br />
                                        Label型のオブジェクトを生成してからそれに対して必要な情報をセットし、表示座標と文字の色を調整しています。<br /><br />
                                        注意事項としては、Labelクラスのオブジェクトを作成する時にセットする引数が文字列以外の場合エラーとなってしまいます。<br />
                                        なので、スコアと言った数字のデータを表示したい時は<b>13行目</b>のように文字列形式でキャストするようにしてください。
                                    </p>
                                </div>
                            </div>

                            <!-- スコア判定を追加してみよう:実践編 -->
                            <div class="exam_inline">
                                <h3 id="5_6">スコア判定を追加してみよう:実践編</h3>

                                <div class="exam_description">
                                    <p>
                                        それではここまでの内容を踏まえて<b>~/src/edit/main.js</b>を拡張していきましょう！<br />
                                        最後になっても、変わらずまずはじめに処理の流れについての確認から行いたいと思います。
                                    </p>
                                </div>

                                <div class="well">
                                    <h5>おだいもく</h5>
                                    <ul class="procedure">
                                        <li>ゲーム上にラベルを出力するプログラムを追加する</li>
                                        <li>自身のキャラクターが土管を潜り抜ける度に、スコアが2点ずつ加算されていく</li>
                                    </ul>
                                </div>

                                <div class="exam_description">
                                    <p>
                                        スコアに加算する条件もいろいろな方法があるかとは思いますが、障害物の土管が右から左に流れていった時に画面の中央よりも左側に移動するタイミングでスコアを加算してあげる方法が比較的シンプルで取っ付きやすいかもしれません。<br />
                                        もし、行き詰まったりされた時にはご参考にしていただけると幸いです:-)
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- exam_content -->
                    </div>
                    <!-- section -->

                    <div class="section_block">
                        <div class="page-header">
                            <h2 id="6_0">さいごに</h2>
                        </div>

                        <!-- exam_content -->
                        <div class="exam_content">
                            <a href="javascript:smoothScroll('my_top');">
                                ↑トップへ戻る
                            </a>

                            <div class="exam_description">
                                <p>
                                    お疲れ様でした、いかがでしたでしょうか？<br />
                                    僕達が普段遊んでいるゲームがどのようにして動いているのか、ちょっとでも雰囲気が掴めたなら幸いです。<br /><br />
                                    ゲームエンジンも今回はenchant.jsを採用しましたが、他にも沢山のものがあります。<br />
                                    enchant.jsを掘り下げてみるのも良いですし、他にもどういったものがあるのか見てみるのも良いかもしれません。<br />
                                    エンジンが変わっても、言語が変わっても今回やった内容や見方なんかは使っていける部分もある・・・と良いなと思います。<br />
                                    自分に合ったものを見つけて、仲間を見つけて。ああだこうだ言いながら「僕が考えたさいきょうのげーむ」を作ってみるのも良いかもしれません。もちろん一人でやるのも良いですが、誰かとやるのもそれはそれでまた別の楽しさがあります。<br />
                                    また、次も機会があれば今度はゲームエンジンを変えたりして3Dなんかも・・・。<br />
                                    なんて思いつつ、ありがとうございました！<br /><br />

                                    @eccyun<br />
                                    <a href="http://eccyun.me/" target="_blank">てんてーちぶ</a><br />
                                    <a href="http://twitter.com/eccyun" target="_blank">Twitter</a><br />
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function smoothScroll(node){
                var pos = $( "#"+node).position();
                $('html,body').animate({ scrollTop: pos.top-60}, 1000, 'easeOutQuad');
            }
        </script>
    </body>
</html>